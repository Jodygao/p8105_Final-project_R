---
title: "P8105 Fall 2023 Final Project Proposal"
date: "2023-11-10"
author: "All Group Member Collaboration"
output: github_document
---

```{r setup, include=FALSE}
library(haven)
library(tidyverse)
```

### Group Members

- Yuandi Gao (yg2907) 
- Yi Li (yl5214)
- Yingting Zhang (yz4434)
- Ruohan Hong (rh3132)
- Shiqi Wu (sw3737)

## Import data from NHANES
```{r}
import_df= function(path){
  read_xpt(path)
}
obesity=
  import_df(path='data/P_BMX.XPT') |> 
  full_join((import_df(path='data/P_DEMO.XPT')), by='SEQN') |>
  full_join((import_df(path='data/P_PAQ.XPT')), by='SEQN')|>
  full_join ((import_df(path='data/P_DBQ.XPT')), by='SEQN') |> 
  select (SEQN,RIAGENDR,RIDAGEYR,DMDMARTZ,INDFMPIR,RIDRETH3,DMDEDUC2,PAD680,BMXBMI,DBD900,DBD910) |> 
  filter(
    !(DMDMARTZ %in% c('77','99','.') ),
    !(INDFMPIR == '.'),
    !(DMDEDUC2 %in% c('7','9','.') ),
    !(PAD680 %in% c('7777', '9999', '.')),
    !(BMXBMI =='.'),
    !(DBD900 %in% c('7777', '9999', '.')),
    !(DBD910 %in% c('7777', '9999', '.'))
  ) |> 
  rename(
    gender=RIAGENDR,
    age=RIDAGEYR,
    marital_status=DMDMARTZ,
    income_to_poverty=INDFMPIR,
    race=RIDRETH3,
    education=DMDEDUC2,
    sedentary_activity=PAD680,
    bmi=BMXBMI,
    freq_fast_food=DBD900,
    freq_frozen=DBD910
  ) |> 
  mutate(
    gender = case_match(
      gender,
      1~"Male",
      2~"Female"),
    gender = as.factor(gender),
  marital_status= case_match(
    marital_status,
      1~"Married",
      2~"Widowed/Divorced/Separated",
      3~"Never married"
  ),
    race= case_match(
    race,
      1~"Mexican American",
      2~"Other Hispanic",
      3~"White",
      4~"Black",
      5~"Asian",
      6~"Other"
     ),
      education= case_match(
    education,
      1~"Less than 9th grade",
      2~"9-11th grade",
      3~"High school graduate" ,
      4~"Some college or AA degree",
      6~"College graduate or above"
     ),
   bmi =case_when(
    bmi<30 ~ 'normal',
    bmi>=30 ~'obese'
  )
  )
  
```


## Graphs
```{r setup, include=FALSE}
library(ggplot2)
library(dplyr)
library(reshape2)
```

### Bar Chart of Obesity Prevalence by Race and Gender
```{r}
ggplot(obesity, aes(x = race, fill = gender)) +
  geom_bar(position = "dodge") +
  scale_fill_manual(values = c("pink", "lightblue")) +
  labs(title = "Obesity Prevalence by Race and Gender",
       x = "Race",
       y = "Count") +
  theme_minimal()
```

### Histogram of Age Distribution Among Obese Individuals
```{r}
ggplot(subset(obesity, bmi == "obese"), aes(x = age)) +
  geom_histogram(binwidth = 1, fill = "pink", color = "lightblue") +
  labs(title = "Age Distribution of Obese Individuals",
       x = "Age",
       y = "Count") +
  theme_minimal()
```

### Box Plot of Income to Poverty Ratio for Obese Individuals
```{r}
ggplot(subset(obesity, bmi == "obese"), aes(y = income_to_poverty, x = "", fill = bmi)) +
  geom_boxplot() +
  scale_fill_manual(values = c("pink")) +
  labs(title = "Income to Poverty Ratio Among Obese Individuals",
       x = "",
       y = "Income to Poverty Ratio") +
  theme_minimal()
```

### Scatter Plot of BMI vs. Sedentary Activity
```{r}
ggplot(obesity, aes(x = sedentary_activity, y = bmi, color = bmi)) +
  geom_point() +
  scale_color_manual(values = c("normal" = "lightblue", "obese" = "pink")) +
  labs(title = "BMI vs. Sedentary Activity",
       x = "Sedentary Activity (minutes)",
       y = "BMI") +
  theme_minimal()
```

### Heat Map of Fast Food and Frozen Meal Consumption
```{r}
aggregated_data <- obesity %>%
  group_by(age, gender) %>%
  summarize(avg_fast_food = mean(freq_fast_food, na.rm = TRUE),
            avg_frozen_food = mean(freq_frozen, na.rm = TRUE))

melted_data <- melt(aggregated_data, id.vars = c("age", "gender"))

ggplot(melted_data, aes(x = age, y = variable, fill = value)) +
  geom_tile() +
  scale_fill_gradient(low = "lightblue", high = "pink") +
  labs(title = "Heat Map of Fast Food and Frozen Meal Consumption",
       x = "Age",
       y = "Food Type",
       fill = "Average Consumption") +
  theme_minimal()
```

