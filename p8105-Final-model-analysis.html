<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>p8105-Final-model-analysis</title>

<script src="site_libs/header-attrs-2.25/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="BRFSS-Analysis.html">US Overview</a>
</li>
<li>
  <a href="Data-Sources.html">Data Sources</a>
</li>
<li>
  <a href="Yi-data-clean.html">Preliminary Analysis</a>
</li>
<li>
  <a href="p8105-Final-model-analysis.html">Exploratory Analysis</a>
</li>
<li>
  <a href="Conclusion.html">Conclusion</a>
</li>
<li>
  <a href="https://github.com/Jodygao/p8105_Final-project_R.git">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">




</div>


<div id="p8105-fall-2023-final-project-proposal" class="section level1">
<h1>P8105 Fall 2023 Final Project Proposal</h1>
<p>All Group Member Collaboration 2023-12-07</p>
<div id="group-members" class="section level3">
<h3>Group Members</h3>
<ul>
<li>Yuandi Gao (yg2907)</li>
<li>Yi Li (yl5214)</li>
<li>Yingting Zhang (yz4434)</li>
<li>Ruohan Hong (rh3132)</li>
<li>Shiqi Wu (sw3737)</li>
</ul>
</div>
<div id="import-data-from-nhanes" class="section level2">
<h2>Import data from NHANES</h2>
<pre class="r"><code>import_df= function(path){
  read_xpt(path)
}
obesity=
  import_df(path=&#39;data/P_BMX.XPT&#39;) |&gt; 
  full_join((import_df(path=&#39;data/P_DEMO.XPT&#39;)), by=&#39;SEQN&#39;) |&gt;
  full_join((import_df(path=&#39;data/P_PAQ.XPT&#39;)), by=&#39;SEQN&#39;)|&gt;
  full_join ((import_df(path=&#39;data/P_DBQ.XPT&#39;)), by=&#39;SEQN&#39;) |&gt; 
  select (SEQN,RIAGENDR,RIDAGEYR,DMDMARTZ,INDFMPIR,RIDRETH3,DMDEDUC2,PAD680,BMXBMI,DBD900,DBD910) |&gt; 
  filter(
    !(DMDMARTZ %in% c(&#39;77&#39;,&#39;99&#39;,&#39;.&#39;) ),
    !(INDFMPIR == &#39;.&#39;),
    !(DMDEDUC2 %in% c(&#39;7&#39;,&#39;9&#39;,&#39;.&#39;) ),
    !(PAD680 %in% c(&#39;7777&#39;, &#39;9999&#39;, &#39;.&#39;)),
    !(BMXBMI ==&#39;.&#39;),
    !(DBD900 %in% c(&#39;7777&#39;, &#39;9999&#39;, &#39;.&#39;)),
    !(DBD910 %in% c(&#39;7777&#39;, &#39;9999&#39;, &#39;.&#39;))
  ) |&gt; 
  rename(
    gender=RIAGENDR,
    age=RIDAGEYR,
    marital_status=DMDMARTZ,
    income_to_poverty=INDFMPIR,
    race=RIDRETH3,
    education=DMDEDUC2,
    sedentary_activity=PAD680,
    bmi=BMXBMI,
    freq_fast_food=DBD900,
    freq_frozen=DBD910
  ) |&gt; 
  mutate(
    gender = case_match(
      gender,
      1~&quot;Male&quot;,
      2~&quot;Female&quot;),
    gender = as.factor(gender),
  marital_status= case_match(
    marital_status,
      1~&quot;Married&quot;,
      2~&quot;Widowed/Divorced/Separated&quot;,
      3~&quot;Never married&quot;
  ),
    race= case_match(
    race,
      1~&quot;Mexican American&quot;,
      2~&quot;Other Hispanic&quot;,
      3~&quot;White&quot;,
      4~&quot;Black&quot;,
      5~&quot;Asian&quot;,
      6~&quot;Other&quot;
     ),
      education= case_match(
    education,
      1~&quot;Less than 9th grade&quot;,
      2~&quot;9-11th grade&quot;,
      3~&quot;High school graduate&quot; ,
      4~&quot;Some college or AA degree&quot;,
      6~&quot;College graduate or above&quot;
     ),
   obese =case_when(
    bmi&lt;30 ~ &#39;normal&#39;,
    bmi&gt;=30 ~&#39;obese&#39;
  )
  )</code></pre>
<pre class="r"><code># Histogram for BMI
ggplot(obesity, aes(x = bmi)) + 
  geom_histogram(binwidth = 1, fill = &quot;blue&quot;, color = &quot;black&quot;) + 
  labs(title = &quot;Distribution of BMI&quot;, x = &quot;BMI&quot;, y = &quot;Count&quot;) + 
  theme_minimal()</code></pre>
<p><img
src="p8105-Final-model-analysis_files/figure-gfm/data%20distribution%20plots-1.png" /><!-- --></p>
<pre class="r"><code># Density plot for BMI
ggplot(obesity, aes(x = bmi)) + 
  geom_density(fill = &quot;blue&quot;, alpha = 0.5) + 
  labs(title = &quot;Density Plot for BMI&quot;, x = &quot;BMI&quot;, y = &quot;Density&quot;) + 
  theme_minimal()</code></pre>
<p><img
src="p8105-Final-model-analysis_files/figure-gfm/data%20distribution%20plots-2.png" /><!-- --></p>
<pre class="r"><code># Boxplot for BMI
ggplot(obesity, aes(y = bmi, x = 1)) + 
  geom_boxplot(fill = &quot;blue&quot;, alpha = 0.5) + 
  labs(title = &quot;Boxplot for BMI&quot;, x = &quot;&quot;, y = &quot;BMI&quot;) + 
  theme_minimal()</code></pre>
<p><img
src="p8105-Final-model-analysis_files/figure-gfm/data%20distribution%20plots-3.png" /><!-- --></p>
<p>The histogram and density plot indicate that the distribution of
<code>BMI</code> is right-skewed, which is a common observation in
health-related data.</p>
<p>When the response variable in a regression model, BMI, in our case,
is not normally distributed, we took a common approach is to apply a
transformation to achieve normality. The logarithmic transformation is
particularly useful because it is a monotonic transformation that can
handle positive skewness by compressing the long tail and expanding the
lower end of the distribution. This can make the distribution more
symmetric and more closely approximate the normal distribution, which
meets the assumptions of linear regression.</p>
<p>By transforming <code>BMI</code> using the natural logarithm, we can
stabilize the variance (homoscedasticity) and make the relationship
between the predictors and the response variable more linear. This is
beneficial because linear regression assumes a linear relationship
between the predictors and the outcome variable.</p>
</div>
<div
id="cross-validation-and-model-comparison-for-predicting-bmi-based-on-fast-food-frequency"
class="section level2">
<h2>Cross-Validation and Model Comparison for Predicting BMI Based on
Fast Food Frequency</h2>
<p>First, we compare the three models for predictor fast food
frequency</p>
<pre class="r"><code>cv_df = 
  obesity |&gt; 
  crossv_mc(n = 100) |&gt; 
  mutate(
    train = map(train, as_tibble),
    test = map(test, as_tibble)
  )
cv_results =
  cv_df |&gt; 
  mutate(
    model_fast_crude = map(train, \(df) lm(log(bmi) ~ freq_fast_food, data = df) ),
    model_fast_adjusted = map(train, \(df) lm(log(bmi) ~ freq_fast_food+age+gender+marital_status+ race+education+income_to_poverty, data = df)),
    model_fast_inter = map(train, \(df) lm(log(bmi) ~ freq_fast_food*education+freq_fast_food*income_to_poverty+freq_fast_food+age+gender+marital_status+ race+education+income_to_poverty, data = df))
  ) |&gt; 
  mutate(
    rmse_fast_crude = map2_dbl(model_fast_crude, test, \(mod, df) rmse(mod, df)),
    rmse_fast_adjusted = map2_dbl(model_fast_adjusted, test, \(mod, df) rmse(mod, df)),
    rmse_fast_inter = map2_dbl(model_fast_inter, test, \(mod, df) rmse(mod, df))
  )</code></pre>
</div>
</div>
<div id="plot-of-model-comparison-of-fast-food-frequency"
class="section level1">
<h1>Plot of model comparison of fast food frequency</h1>
<pre class="r"><code>cv_results |&gt; 
  select(starts_with(&quot;rmse&quot;)) |&gt; 
  pivot_longer(
    everything(),
    names_to = &quot;model_type&quot;,
    values_to = &quot;rmse&quot;,
    names_prefix = &quot;rmse_&quot;
  ) |&gt; 
  group_by(model_type) |&gt; 
  summarize(m_rmse = mean(rmse))</code></pre>
<pre><code>## # A tibble: 3 × 2
##   model_type    m_rmse
##   &lt;chr&gt;          &lt;dbl&gt;
## 1 fast_adjusted  0.323
## 2 fast_crude     0.498
## 3 fast_inter     0.344</code></pre>
<pre class="r"><code>cv_results |&gt; 
  select(starts_with(&quot;rmse&quot;)) |&gt; 
  pivot_longer(
    everything(),
    names_to = &quot;model_type&quot;,
    values_to = &quot;rmse&quot;,
    names_prefix = &quot;rmse_&quot;
  ) |&gt; 
  ggplot(aes(x = model_type, y = rmse)) +
  geom_violin()</code></pre>
<p><img
src="p8105-Final-model-analysis_files/figure-gfm/model%20comparison-1.png" /><!-- --></p>
<div id="interpretion-of-the-fast-food-frequncy-in-terms-of-bmi"
class="section level2">
<h2>Interpretion of the fast food frequncy in terms of BMI:</h2>
<p><code>fast_adjusted</code> model has a lower median with most of its
data concentrated at the lower end of the rmse scale, which suggests
better predictive performance for most of its predictions compared to
the other models. <code>fast_crude</code> model has a wider spread of
values, indicating less consistency in predictive performance.
<code>fast_inter</code> has most of its data concentrated at the low end
like fast_adjusted, but the long tail indicates there are also quite a
few cases where its predictions are much worse. Considering this,
<code>fast_adjusted</code> seems to be the best model overall due to its
concentration of lower rmse values, although <code>fast_inter</code> may
also perform similarly well for the majority of predictions but has some
predictions with high error.</p>
</div>
<div id="interpretation-of-fast-food-variable" class="section level2">
<h2>Interpretation of fast food variable:</h2>
<p>For one unit increase in number of meals from fast food or pizza
place, the bmi will decrease by 0.0026 kg/m^2, while adjusting for all
other covariate in the model.</p>
</div>
<div
id="cross-validation-and-model-comparison-for-predicting-bmi-based-on-fast-food-frequencybmi-and-predictor-sendendary-activity"
class="section level2">
<h2>Cross-Validation and Model Comparison for Predicting BMI Based on
Fast Food FrequencyBMI and predictor sendendary activity</h2>
<pre class="r"><code># Histogram and Density Plot for Sedentary Activity
ggplot(obesity, aes(x = sedentary_activity)) +
  geom_histogram(binwidth = 10, fill = &quot;green&quot;, color = &quot;black&quot;, alpha = 0.7) + 
  geom_density(alpha = 0.2, adjust = 1/5) + 
  labs(title = &quot;Distribution of Sedentary Activity&quot;, x = &quot;Sedentary Activity&quot;, y = &quot;Density&quot;) +
  theme_minimal()</code></pre>
<pre><code>## Warning: Removed 3879 rows containing non-finite values (`stat_bin()`).

## Warning: Removed 3879 rows containing non-finite values (`stat_density()`).</code></pre>
<p><img
src="p8105-Final-model-analysis_files/figure-gfm/distribution-1.png" /><!-- --></p>
</div>
</div>
<div id="step-1-model-building-for-sedentary-activity-with-logbmi"
class="section level1">
<h1>Step 1: Model building for sedentary activity with log(BMI)</h1>
<pre class="r"><code>cv_df_sedentary = 
  obesity |&gt; 
  crossv_mc(n = 100) |&gt; 
  mutate(
    train = map(train, as_tibble),
    test = map(test, as_tibble)
  )

cv_results_sedentary =
  cv_df_sedentary |&gt; 
  mutate(
    model_sed_crude = map(train, \(df) lm(log(bmi) ~ sedentary_activity, data = df)),
    model_sed_adjusted = map(train, \(df) lm(log(bmi) ~ sedentary_activity+age+gender+marital_status+race+education+income_to_poverty, data = df)),
    model_sed_inter = map(train, \(df) lm(log(bmi) ~ sedentary_activity*education+sedentary_activity*income_to_poverty+sedentary_activity+age+gender+marital_status+race+education+income_to_poverty, data = df))
  ) |&gt; 
  mutate(
    rmse_sed_crude = map2_dbl(model_sed_crude, test, \(mod, df) rmse(mod, df)),
    rmse_sed_adjusted = map2_dbl(model_sed_adjusted, test, \(mod, df) rmse(mod, df)),
    rmse_sed_inter = map2_dbl(model_sed_inter, test, \(mod, df) rmse(mod, df))
  )</code></pre>
<pre class="r"><code>cv_results_sedentary |&gt; 
  select(starts_with(&quot;rmse_sed&quot;)) |&gt; 
  pivot_longer(
    everything(),
    names_to = &quot;model_type&quot;,
    values_to = &quot;rmse&quot;,
    names_prefix = &quot;rmse_sed_&quot;
  ) |&gt; 
  ggplot(aes(x = model_type, y = rmse)) +
  geom_violin()</code></pre>
<p><img
src="p8105-Final-model-analysis_files/figure-gfm/cross%20validation%20comparison-1.png" /><!-- --></p>
</div>
<div id="summary-of-cross-validation-results--sendendary-activity"
class="section level1">
<h1>Summary of Cross validation Results- sendendary activity</h1>
<pre class="r"><code>cv_results_sedentary |&gt; 
  select(starts_with(&quot;rmse_sed&quot;)) |&gt; 
  pivot_longer(
    everything(),
    names_to = &quot;model_type&quot;,
    values_to = &quot;rmse&quot;,
    names_prefix = &quot;rmse_sed_&quot;
  ) |&gt; 
  group_by(model_type) |&gt; 
  summarize(m_rmse = mean(rmse))</code></pre>
<pre><code>## # A tibble: 3 × 2
##   model_type m_rmse
##   &lt;chr&gt;       &lt;dbl&gt;
## 1 adjusted    0.235
## 2 crude       0.237
## 3 inter       0.235</code></pre>
<p>In the context of these models, a lower RMSE indicates a more
accurate prediction of BMI from the predictors used in the model.</p>
<p>The cross-validation results show that the mean RMSE for the adjusted
and inter (interaction) models are both 0.235, while the crude model has
a slightly higher RMSE of 0.237. In this case, both the adjusted and
inter models perform slightly better than the crude model, as indicated
by their lower RMSE values, which means they are, on average, closer to
the true BMI values when log-transformed.</p>
<p>A valid reason we choose the adjusted model over the inter model,
despite having the same RMSE, could be due to its simplicity and
interpretability. The adjusted model includes additional covariates
(age, gender, marital status, race, education, and income to poverty
ratio) that are expected to be related to BMI based on previous research
or theoretical considerations. Including these covariates allows the
model to account for more variability in BMI that is explained by these
factors.</p>
<p>Moreover, while interaction terms in the inter model may capture the
combined effects of sedentary activity with other variables, they can
make the model more complex and harder to interpret. We proceed the
model statitics in adjusted model for sedentary activity.</p>
<pre class="r"><code># Step 1: Generate new data for plotting
new_data &lt;- with(obesity, expand.grid(
  sedentary_activity = seq(min(sedentary_activity, na.rm = TRUE), max(sedentary_activity, na.rm = TRUE), length.out = 100),
  age = mean(age, na.rm = TRUE),
  gender = &quot;Female&quot;, 
  marital_status = &quot;Married&quot;, 
  race = &quot;White&quot;, 
  education = &quot;Less than 9th grade&quot;, 
  income_to_poverty = mean(income_to_poverty, na.rm = TRUE)
))

# Step 2: Predict log(BMI) using the adjusted model and the new data
adjusted_model &lt;- cv_results_sedentary$model_sed_adjusted[[1]]
new_data$log_bmi_pred &lt;- predict(adjusted_model, newdata = new_data)

# Step 3: Create the plot
ggplot(new_data, aes(x = sedentary_activity, y = log_bmi_pred)) +
  geom_line(color = &quot;blue&quot;) +
  labs(title = &quot;Predicted Log BMI vs Sedentary Activity&quot;,
       x = &quot;Sedentary Activity&quot;,
       y = &quot;Predicted Log BMI&quot;) +
  theme_minimal()</code></pre>
<p><img
src="p8105-Final-model-analysis_files/figure-gfm/model%20plot%20for%20adjusted%20model-1.png" /><!-- --></p>
<pre class="r"><code># Extract the summary of the &#39;adjusted&#39; model
best_model_summary &lt;- cv_results_sedentary$model_sed_adjusted[[1]] %&gt;% summary()

# Print the summary which includes beta coefficients, p-values, etc.
print(best_model_summary)</code></pre>
<pre><code>## 
## Call:
## lm(formula = log(bmi) ~ sedentary_activity + age + gender + marital_status + 
##     race + education + income_to_poverty, data = df)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.74286 -0.15466 -0.00925  0.14627  1.12170 
## 
## Coefficients:
##                                            Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)                               3.373e+00  1.875e-02 179.910  &lt; 2e-16
## sedentary_activity                        1.753e-04  1.902e-05   9.215  &lt; 2e-16
## age                                       2.542e-04  2.428e-04   1.047 0.295121
## genderMale                               -4.675e-02  7.506e-03  -6.228 5.19e-10
## marital_statusNever married              -2.834e-02  1.058e-02  -2.679 0.007423
## marital_statusWidowed/Divorced/Separated -2.961e-02  9.662e-03  -3.064 0.002195
## raceMexican American                     -1.085e-02  1.269e-02  -0.855 0.392727
## raceOther                                -1.664e-01  1.519e-02 -10.953  &lt; 2e-16
## raceOther Hispanic                       -1.945e-02  1.339e-02  -1.453 0.146268
## raceWhite                                -3.598e-02  9.357e-03  -3.845 0.000122
## educationHigh school graduate             1.718e-02  1.191e-02   1.442 0.149283
## educationLess than 9th grade              5.379e-03  1.608e-02   0.335 0.737935
## educationSome college or AA degree        2.145e-02  1.173e-02   1.829 0.067442
## income_to_poverty                        -1.433e-03  2.723e-03  -0.526 0.598765
##                                             
## (Intercept)                              ***
## sedentary_activity                       ***
## age                                         
## genderMale                               ***
## marital_statusNever married              ** 
## marital_statusWidowed/Divorced/Separated ** 
## raceMexican American                        
## raceOther                                ***
## raceOther Hispanic                          
## raceWhite                                ***
## educationHigh school graduate               
## educationLess than 9th grade                
## educationSome college or AA degree       .  
## income_to_poverty                           
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2347 on 4048 degrees of freedom
##   (5048 observations deleted due to missingness)
## Multiple R-squared:  0.06094,    Adjusted R-squared:  0.05793 
## F-statistic: 20.21 on 13 and 4048 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code># Plotting the &#39;adjusted&#39; model&#39;s fitted values vs. residuals
best_model &lt;- cv_results_sedentary$model_sed_adjusted[[1]]
best_model_residuals &lt;- resid(best_model)
best_model_fitted &lt;- fitted(best_model)

# Create a residuals vs fitted values plot
residual_plot &lt;- ggplot() +
  geom_point(aes(x = best_model_fitted, y = best_model_residuals)) +
  geom_hline(yintercept = 0, linetype = &quot;dashed&quot;, color = &quot;red&quot;) +
  labs(title = &quot;Residuals vs Fitted Values for Interaction Model&quot;,
       x = &quot;Fitted Values&quot;,
       y = &quot;Residuals&quot;) +
  theme_minimal() +
  geom_smooth(aes(x = best_model_fitted, y = best_model_residuals), method = &quot;loess&quot;, se = FALSE)

# Print the residual plot
print(residual_plot)</code></pre>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img
src="p8105-Final-model-analysis_files/figure-gfm/residual%20plot%20for%20activity-1.png" /><!-- --></p>
<div id="interpretation-of-the-adjusted-model-activity"
class="section level2">
<h2>Interpretation of the Adjusted model (activity)</h2>
<p><code>Coefficients Interpretation on Log Scale</code>:
<code>Intercept</code>: The estimated <code>log(BMI)</code> is
approximately 3.366 when all predictor variables are held at zero. To
interpret this on the original BMI scale, you would calculate
exp(3.366). This value represents the estimated BMI for the baseline
categories of all categorical predictors (usually the most common or
reference category) and zero for continuous predictors.</p>
<p><code>Sedentary Activity</code>: The coefficient for sedentary
activity is positive (0.0001905) and statistically significant. This
suggests that for each unit increase in sedentary activity, the log(BMI)
increases by this amount. To interpret the effect on the original BMI
scale, consider that a small increase in the <code>log(BMI)</code>
corresponds to a percentage increase in BMI. Specifically, a one-unit
increase in sedentary activity is associated with approximately a
0.01905% increase in BMI.</p>
<p><code>Other Predictors</code>: Similarly, for other continuous
predictors like age, the coefficient represents the percentage change in
BMI for a one-unit increase in that predictor. For categorical
predictors like gender, marital status, and race, the coefficients
represent the percentage difference in BMI compared to the reference
category.</p>
<p><code>Model Fit and R-squared</code>: The <code>R-squared</code>
value (0.06851) indicates that about 6.851% of the variability in
log-transformed BMI is explained by the model. While this might seem
low, it’s not uncommon in behavioral and social science research where
many unmeasured factors can influence the outcome. Statistical
Significance:</p>
<p>The significance of the coefficients suggests that these factors have
a statistically significant association with BMI. However, the magnitude
of these effects might be small, especially for variables like age and
income_to_poverty ratio.</p>
<p>Overall Interpretation: The significant predictors in the model, like
<code>sedentary activity</code> and <code>gender</code>, indicate
factors that are associated with <code>BMI</code>. However, the small
R-squared value suggests that many other factors not included in the
model also influence <code>BMI</code>. Given that the response variable
is log-transformed, the interpretation is in terms of percentage change
(for continuous predictors) or relative percentage difference (for
categorical predictors) in BMI.</p>
</div>
</div>
<div
id="cross-validation-and-model-buildup-for-predicting-bmi-based-on-frozen-fast-food-frequency"
class="section level1">
<h1>Cross-Validation and Model Buildup for Predicting BMI Based on
Frozen Fast Food Frequency</h1>
<pre class="r"><code>cv_df_frozen = 
  obesity |&gt; 
  crossv_mc(n = 100) |&gt; 
  mutate(
    train = map(train, as_tibble),
    test = map(test, as_tibble)
  )</code></pre>
</div>
<div id="model-building-for-frozen-fast-food-with-logbmi"
class="section level1">
<h1>Model building for frozen fast food with log(BMI)</h1>
<pre class="r"><code>cv_results_frozen =
  cv_df_frozen |&gt; 
  mutate(
    model_frozen_crude = map(train, \(df) lm(log(bmi) ~ freq_frozen, data = df)),
    model_frozen_adjusted = map(train, \(df) lm(log(bmi) ~ freq_frozen + age + gender + marital_status + race + education + income_to_poverty, data = df)),
    model_frozen_inter = map(train, \(df) lm(log(bmi) ~ freq_frozen * education + freq_frozen * income_to_poverty + freq_frozen + age + gender + marital_status + race + education + income_to_poverty, data = df))
  ) |&gt; 
  mutate(
    rmse_frozen_crude = map2_dbl(model_frozen_crude, test, \(mod, df) rmse(mod, df)),
    rmse_frozen_adjusted = map2_dbl(model_frozen_adjusted, test, \(mod, df) rmse(mod, df)),
    rmse_frozen_inter = map2_dbl(model_frozen_inter, test, \(mod, df) rmse(mod, df))
  )</code></pre>
</div>
<div id="cross-validation-comparison" class="section level1">
<h1>Cross-validation comparison</h1>
<pre class="r"><code>cv_results_frozen |&gt; 
  select(starts_with(&quot;rmse_frozen&quot;)) |&gt; 
  pivot_longer(
    everything(),
    names_to = &quot;model_type&quot;,
    values_to = &quot;rmse&quot;,
    names_prefix = &quot;rmse_frozen_&quot;
  ) |&gt; 
  ggplot(aes(x = model_type, y = rmse)) +
  geom_violin()</code></pre>
<p><img
src="p8105-Final-model-analysis_files/figure-gfm/unnamed-chunk-5-1.png" /><!-- --></p>
</div>
<div id="summary-of-cross-validation-results" class="section level1">
<h1>Summary of Cross-Validation Results</h1>
<pre class="r"><code>cv_results_frozen |&gt; 
  select(starts_with(&quot;rmse_frozen&quot;)) |&gt; 
  pivot_longer(
    everything(),
    names_to = &quot;model_type&quot;,
    values_to = &quot;rmse&quot;,
    names_prefix = &quot;rmse_frozen_&quot;
  ) |&gt; 
  group_by(model_type) |&gt; 
  summarize(m_rmse = mean(rmse))</code></pre>
<pre><code>## # A tibble: 3 × 2
##   model_type m_rmse
##   &lt;chr&gt;       &lt;dbl&gt;
## 1 adjusted    0.243
## 2 crude       0.309
## 3 inter       0.336</code></pre>
</div>
<div id="model-plot-for-adjusted-model" class="section level1">
<h1>Model Plot for Adjusted Model</h1>
</div>
<div id="generate-new-data-for-plotting" class="section level1">
<h1>Generate new data for plotting</h1>
<pre class="r"><code>obesity$marital_status &lt;- factor(obesity$marital_status)
obesity$race &lt;- factor(obesity$race)
obesity$education &lt;- factor(obesity$education)

new_data_frozen &lt;- expand.grid(
  freq_frozen = seq(min(obesity$freq_frozen, na.rm = TRUE), max(obesity$freq_frozen, na.rm = TRUE), length.out = 100),
  age = mean(obesity$age, na.rm = TRUE),
  gender = levels(obesity$gender)[1],
  marital_status = levels(obesity$marital_status)[1],
  race = levels(obesity$race)[1],
  education = levels(obesity$education)[1],
  income_to_poverty = mean(obesity$income_to_poverty, na.rm = TRUE)
)

str(new_data_frozen)</code></pre>
<pre><code>## &#39;data.frame&#39;:    100 obs. of  7 variables:
##  $ freq_frozen      : num  0 67.3 134.7 202 269.3 ...
##  $ age              : num  35.6 35.6 35.6 35.6 35.6 ...
##  $ gender           : Factor w/ 1 level &quot;Female&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ marital_status   : Factor w/ 1 level &quot;Married&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ race             : Factor w/ 1 level &quot;Black&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ education        : Factor w/ 1 level &quot;9-11th grade&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ income_to_poverty: num  2.42 2.42 2.42 2.42 2.42 ...
##  - attr(*, &quot;out.attrs&quot;)=List of 2
##   ..$ dim     : Named int [1:7] 100 1 1 1 1 1 1
##   .. ..- attr(*, &quot;names&quot;)= chr [1:7] &quot;freq_frozen&quot; &quot;age&quot; &quot;gender&quot; &quot;marital_status&quot; ...
##   ..$ dimnames:List of 7
##   .. ..$ freq_frozen      : chr [1:100] &quot;freq_frozen=   0.00000&quot; &quot;freq_frozen=  67.33333&quot; &quot;freq_frozen= 134.66667&quot; &quot;freq_frozen= 202.00000&quot; ...
##   .. ..$ age              : chr &quot;age=35.62302&quot;
##   .. ..$ gender           : chr &quot;gender=Female&quot;
##   .. ..$ marital_status   : chr &quot;marital_status=Married&quot;
##   .. ..$ race             : chr &quot;race=Black&quot;
##   .. ..$ education        : chr &quot;education=9-11th grade&quot;
##   .. ..$ income_to_poverty: chr &quot;income_to_poverty=2.42299&quot;</code></pre>
</div>
<div id="predict-logbmi-using-the-adjusted-model-and-the-new-data"
class="section level1">
<h1>Predict log(BMI) using the adjusted model and the new data</h1>
<pre class="r"><code>adjusted_model_frozen &lt;- cv_results_frozen$model_frozen_adjusted[[1]]
new_data_frozen$log_bmi_pred &lt;- predict(adjusted_model_frozen, newdata = new_data_frozen)

# Plot the predicted values
ggplot(new_data_frozen, aes(x = freq_frozen, y = log_bmi_pred)) +
  geom_line(color = &quot;purple&quot;) +
  labs(title = &quot;Predicted Log BMI vs Frozen Fast Food Frequency&quot;,
       x = &quot;Frozen Fast Food Frequency&quot;,
       y = &quot;Predicted Log BMI&quot;) +
  theme_minimal()</code></pre>
<p><img
src="p8105-Final-model-analysis_files/figure-gfm/unnamed-chunk-8-1.png" /><!-- -->
# Summary of the best ‘adjusted’ model from cross-validation</p>
<pre class="r"><code>best_adjusted_model_summary &lt;- cv_results_frozen$model_frozen_adjusted[[1]] %&gt;% summary()

# Print the summary which includes coefficients, R-squared, p-values...
print(best_adjusted_model_summary)</code></pre>
<pre><code>## 
## Call:
## lm(formula = log(bmi) ~ freq_frozen + age + gender + marital_status + 
##     race + education + income_to_poverty, data = df)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.77008 -0.15912 -0.00805  0.14561  1.10981 
## 
## Coefficients:
##                                            Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)                               3.409e+00  1.828e-02 186.500  &lt; 2e-16
## freq_frozen                              -4.291e-06  2.510e-05  -0.171  0.86427
## age                                       1.858e-04  2.437e-04   0.762  0.44584
## genderMale                               -3.741e-02  7.543e-03  -4.960 7.34e-07
## marital_statusNever married              -2.461e-02  1.067e-02  -2.308  0.02106
## marital_statusWidowed/Divorced/Separated -2.941e-02  9.630e-03  -3.054  0.00227
## raceMexican American                      3.671e-03  1.288e-02   0.285  0.77574
## raceOther                                -1.553e-01  1.553e-02  -9.999  &lt; 2e-16
## raceOther Hispanic                       -2.401e-02  1.316e-02  -1.824  0.06818
## raceWhite                                -2.382e-02  9.382e-03  -2.539  0.01117
## educationHigh school graduate             1.253e-02  1.190e-02   1.053  0.29238
## educationLess than 9th grade              6.078e-03  1.628e-02   0.373  0.70897
## educationSome college or AA degree        2.402e-02  1.176e-02   2.042  0.04123
## income_to_poverty                         2.054e-03  2.742e-03   0.749  0.45381
##                                             
## (Intercept)                              ***
## freq_frozen                                 
## age                                         
## genderMale                               ***
## marital_statusNever married              *  
## marital_statusWidowed/Divorced/Separated ** 
## raceMexican American                        
## raceOther                                ***
## raceOther Hispanic                       .  
## raceWhite                                *  
## educationHigh school graduate               
## educationLess than 9th grade                
## educationSome college or AA degree       *  
## income_to_poverty                           
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2363 on 4049 degrees of freedom
##   (5047 observations deleted due to missingness)
## Multiple R-squared:  0.03455,    Adjusted R-squared:  0.03146 
## F-statistic: 11.15 on 13 and 4049 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div id="create-a-residuals-plot-for-the-adjusted-model"
class="section level1">
<h1>Create a residuals plot for the ‘adjusted’ model</h1>
<pre class="r"><code>adjusted_model &lt;- cv_results_frozen$model_frozen_adjusted[[1]]
adjusted_model_residuals &lt;- resid(adjusted_model)
adjusted_model_fitted &lt;- fitted(adjusted_model)

# Plot the residuals against the fitted values
residual_plot &lt;- ggplot() +
  geom_point(aes(x = adjusted_model_fitted, y = adjusted_model_residuals)) +
  geom_hline(yintercept = 0, linetype = &quot;dashed&quot;, color = &quot;red&quot;) +
  labs(title = &quot;Residuals vs Fitted Values for Adjusted Model&quot;,
       x = &quot;Fitted Values&quot;,
       y = &quot;Residuals&quot;) +
  theme_minimal() +
  geom_smooth(aes(x = adjusted_model_fitted, y = adjusted_model_residuals), method = &quot;loess&quot;, se = FALSE)

# Print the residual plot
print(residual_plot)</code></pre>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img
src="p8105-Final-model-analysis_files/figure-gfm/unnamed-chunk-10-1.png" /><!-- --></p>
</div>
<div id="regression-models-and-diagnostics" class="section level1">
<h1>Regression Models and Diagnostics</h1>
<p>Model1: log(BMI)=freq_fast</p>
<pre class="r"><code># Crude model for freq_fast_food
freq_fast_crude = lm(log(bmi) ~ freq_fast_food, data = obesity)

obesity |&gt; modelr::add_residuals(freq_fast_crude) |&gt; 
  ggplot(aes(sample = resid))+stat_qq()+stat_qq_line()</code></pre>
<pre><code>## Warning: Removed 2345 rows containing non-finite values (`stat_qq()`).

## Warning: Removed 2345 rows containing non-finite values (`stat_qq_line()`).</code></pre>
<p><img
src="p8105-Final-model-analysis_files/figure-gfm/unnamed-chunk-11-1.png" /><!-- --></p>
<p>Model2: log(BMI)=sedentary activity</p>
<pre class="r"><code># Crude model for inactivity
inactivity_crude = lm(log(bmi) ~ sedentary_activity, data = obesity)

obesity |&gt; modelr::add_residuals(inactivity_crude) |&gt; 
  ggplot(aes(sample = resid))+stat_qq()+stat_qq_line()</code></pre>
<pre><code>## Warning: Removed 3879 rows containing non-finite values (`stat_qq()`).

## Warning: Removed 3879 rows containing non-finite values (`stat_qq_line()`).</code></pre>
<p><img
src="p8105-Final-model-analysis_files/figure-gfm/unnamed-chunk-12-1.png" /><!-- --></p>
<p>Model3: log(BMI)=freqence of frozen</p>
<pre class="r"><code># Crude model for freq_frozen
freq_frozen_crude = lm(log(bmi) ~ freq_frozen, data = obesity)


obesity |&gt; modelr::add_residuals(freq_frozen_crude) |&gt; 
  ggplot(aes(sample = resid))+stat_qq()+stat_qq_line()</code></pre>
<pre><code>## Warning: Removed 38 rows containing non-finite values (`stat_qq()`).

## Warning: Removed 38 rows containing non-finite values (`stat_qq_line()`).</code></pre>
<p><img
src="p8105-Final-model-analysis_files/figure-gfm/unnamed-chunk-13-1.png" /><!-- --></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
